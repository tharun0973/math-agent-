# ğŸ—ï¸ Math Routing Agent - System Architecture

## ğŸ¯ Overview

The Math Routing Agent is an **Agentic-RAG system** that intelligently routes math questions through multiple sources to provide accurate, step-by-step solutions.

## ğŸ”„ Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INPUT                              â”‚
â”‚                   "Solve x^2 + 5x + 6 = 0"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INPUT VALIDATION                             â”‚
â”‚                  (agent/guardrails.py)                          â”‚
â”‚  â€¢ Check for banned topics                                      â”‚
â”‚  â€¢ Verify math-related content                                  â”‚
â”‚  â€¢ Filter unsafe queries                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   VALID INPUT?        â”‚
          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
              â”‚              â”‚
            NOâ”‚              â”‚YES
              â”‚              â”‚
              â–¼              â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   REJECT    â”‚   â”‚     INTELLIGENT ROUTING            â”‚
      â”‚   RETURN    â”‚   â”‚   (agent/routing.py)               â”‚
      â”‚  ERROR MSG  â”‚   â”‚                                     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                     â”‚
                    â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  1. KNOWLEDGE     â”‚   â”‚  2. WEB SEARCH       â”‚
        â”‚     BASE          â”‚   â”‚     FALLBACK         â”‚
        â”‚  (Qdrant)         â”‚   â”‚  (Tavily + MCP)      â”‚
        â”‚                   â”‚   â”‚                      â”‚
        â”‚  â€¢ Semantic       â”‚   â”‚  â€¢ Search web        â”‚
        â”‚    search         â”‚   â”‚  â€¢ Extract context   â”‚
        â”‚  â€¢ Embeddings     â”‚   â”‚  â€¢ Generate answer   â”‚
        â”‚  â€¢ Metadata       â”‚   â”‚    via Ollama        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                     â”‚
            SUCCESS?              SUCCESS?
                 â”‚                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
          â”‚             â”‚      â”‚             â”‚
        YESâ”‚           NOâ”‚    YESâ”‚           NOâ”‚
          â”‚             â”‚      â”‚             â”‚
          â–¼             â–¼      â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   RETURN    â”‚ â”‚  3. DIRECT MCP           â”‚
   â”‚   ANSWER    â”‚ â”‚     FALLBACK             â”‚
   â”‚             â”‚ â”‚  (Ollama only)           â”‚
   â”‚ â€¢ Steps     â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ â€¢ Solution  â”‚        â”‚
   â”‚ â€¢ Confidenceâ”‚   SUCCESS?
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                   YESâ”‚       NOâ”‚
                     â”‚         â”‚
                     â–¼         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   RETURN    â”‚ â”‚  4. SYMPY        â”‚
            â”‚   ANSWER    â”‚ â”‚     SOLVER       â”‚
            â”‚             â”‚ â”‚                  â”‚
            â”‚ â€¢ Steps     â”‚ â”‚ â€¢ Equations      â”‚
            â”‚ â€¢ Solution  â”‚ â”‚ â€¢ Derivatives    â”‚
            â”‚ â€¢ Confidenceâ”‚ â”‚ â€¢ Integrals      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   RETURN    â”‚
                            â”‚   ANSWER    â”‚
                            â”‚             â”‚
                            â”‚ â€¢ Steps     â”‚
                            â”‚ â€¢ Solution  â”‚
                            â”‚ â€¢ Confidenceâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   OUTPUT SANITIZATION   â”‚
                      â”‚  (agent/guardrails.py)  â”‚
                      â”‚  â€¢ Remove hallucinationsâ”‚
                      â”‚  â€¢ Clean profanity      â”‚
                      â”‚  â€¢ Extract math content â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   RESPONSE TO USER      â”‚
                      â”‚                         â”‚
                      â”‚  â€¢ Answer               â”‚
                      â”‚  â€¢ Steps                â”‚
                      â”‚  â€¢ Solution             â”‚
                      â”‚  â€¢ Source               â”‚
                      â”‚  â€¢ Confidence           â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   FEEDBACK COLLECTION   â”‚
                      â”‚  (backend/main.py)      â”‚
                      â”‚                         â”‚
                      â”‚  â€¢ Rating (1-5)         â”‚
                      â”‚  â€¢ Comment              â”‚
                      â”‚  â€¢ Storage              â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© Component Architecture

### 1. Frontend Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         React Application          â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   Sidebar    â”‚  â”‚ MainContent â”‚â”‚
â”‚  â”‚              â”‚  â”‚             â”‚â”‚
â”‚  â”‚ Chat History â”‚  â”‚ Chat UI     â”‚â”‚
â”‚  â”‚              â”‚  â”‚             â”‚â”‚
â”‚  â”‚  â€¢ List      â”‚  â”‚ â€¢ Markdown  â”‚â”‚
â”‚  â”‚  â€¢ New Chat  â”‚  â”‚ â€¢ KaTeX     â”‚â”‚
â”‚  â”‚              â”‚  â”‚ â€¢ Feedback  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                            â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Call      â”‚
                    â”‚  /solve         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
```

### 2. Backend Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FastAPI Application                       â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Endpoints                            â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚  POST /solve        - Main solving endpoint      â”‚ â”‚
â”‚  â”‚  POST /solve/stream - Streaming responses        â”‚ â”‚
â”‚  â”‚  POST /feedback     - Submit feedback            â”‚ â”‚
â”‚  â”‚  GET  /feedback/stats - Get statistics           â”‚ â”‚
â”‚  â”‚  GET  /health       - Health check               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Routing System                            â”‚
â”‚              (agent/routing.py)                        â”‚
â”‚                                                        â”‚
â”‚  1. Validate Input                                     â”‚
â”‚     â†“                                                  â”‚
â”‚  2. Try KB Search                                      â”‚
â”‚     â†“                                                  â”‚
â”‚  3. Try Web Search                                     â”‚
â”‚     â†“                                                  â”‚
â”‚  4. Try MCP Direct                                     â”‚
â”‚     â†“                                                  â”‚
â”‚  5. Try SymPy Solver                                   â”‚
â”‚     â†“                                                  â”‚
â”‚  6. Sanitize Output                                    â”‚
â”‚     â†“                                                  â”‚
â”‚  7. Return Result                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Knowledge Base Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Knowledge Base (agent/knowledge_base.py)       â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚   Embeddings   â”‚                                    â”‚
â”‚  â”‚                â”‚                                    â”‚
â”‚  â”‚ Sentence       â”‚                                    â”‚
â”‚  â”‚ Transformer    â”‚                                    â”‚
â”‚  â”‚ (MiniLM-L6-v2) â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚           â”‚                                            â”‚
â”‚           â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚    Qdrant      â”‚                                    â”‚
â”‚  â”‚                â”‚                                    â”‚
â”‚  â”‚ Collection:    â”‚                                    â”‚
â”‚  â”‚  math_kb       â”‚                                    â”‚
â”‚  â”‚                â”‚                                    â”‚
â”‚  â”‚ â€¢ Vectors      â”‚                                    â”‚
â”‚  â”‚ â€¢ Metadata     â”‚                                    â”‚
â”‚  â”‚ â€¢ Semantic     â”‚                                    â”‚
â”‚  â”‚   search       â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. External Services

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External Services                         â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   Qdrant     â”‚  â”‚    Tavily    â”‚  â”‚    Ollama    â”‚â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚â”‚
â”‚  â”‚ Vector DB    â”‚  â”‚ Web Search   â”‚  â”‚ Local LLM    â”‚â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚â”‚
â”‚  â”‚ localhost:   â”‚  â”‚ API Key      â”‚  â”‚ Gemma 2B     â”‚â”‚
â”‚  â”‚   6333       â”‚  â”‚ Required     â”‚  â”‚ Optional     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Guardrail System

```
INPUT â†’ [Validation] â†’ OUTPUT â†’ [Sanitization] â†’ RESPONSE
         â”‚                        â”‚
         â”œâ”€ Banned Topics         â”œâ”€ Hallucination Removal
         â”œâ”€ Math Keywords         â”œâ”€ Profanity Filter
         â”œâ”€ Safety Checks         â”œâ”€ Content Extraction
         â””â”€ Length Check          â””â”€ Polishing
```

## ğŸ“Š Data Flow

```
User Query
    â”‚
    â”œâ”€â†’ Guardrails Validation
    â”‚   â””â”€â†’ Valid? â†’ Continue
    â”‚   â””â”€â†’ Invalid? â†’ Reject
    â”‚
    â”œâ”€â†’ KB Search (Qdrant)
    â”‚   â””â”€â†’ Found? â†’ Return + Sanitize
    â”‚   â””â”€â†’ Not Found? â†’ Next
    â”‚
    â”œâ”€â†’ Web Search (Tavily)
    â”‚   â””â”€â†’ Search + Generate (Ollama)
    â”‚   â””â”€â†’ Success? â†’ Return + Sanitize
    â”‚   â””â”€â†’ Failed? â†’ Next
    â”‚
    â”œâ”€â†’ Direct MCP (Ollama)
    â”‚   â””â”€â†’ Generate Answer
    â”‚   â””â”€â†’ Success? â†’ Return + Sanitize
    â”‚   â””â”€â†’ Failed? â†’ Next
    â”‚
    â”œâ”€â†’ SymPy Solver
    â”‚   â””â”€â†’ Solve
    â”‚   â””â”€â†’ Success? â†’ Return + Sanitize
    â”‚   â””â”€â†’ Failed? â†’ Error
    â”‚
    â””â”€â†’ User Response
        â”‚
        â””â”€â†’ Feedback Collection (if provided)
```

## ğŸ›¡ï¸ Safety Features

```
Input Safety:
â”œâ”€ Topic Filtering (50+ banned topics)
â”œâ”€ Math Keyword Detection (30+ keywords)
â”œâ”€ Length Validation
â””â”€ Content Type Check

Output Safety:
â”œâ”€ Hallucination Removal
â”œâ”€ Profanity Filter
â”œâ”€ Answer Verification
â””â”€ Confidence Scoring
```

## ğŸ“ˆ Performance Characteristics

- **Latency**: KB < Web < MCP < SymPy
- **Accuracy**: KB â‰ˆ Web â‰ˆ MCP > SymPy
- **Cost**: KB < SymPy < MCP < Web
- **Reliability**: SymPy > KB > MCP > Web

## ğŸ”„ Fallback Strategy

```
Priority Order:
1. KB (fast, accurate, free)
2. Web (slower, accurate, paid)
3. MCP (medium, good, optional)
4. SymPy (fast, limited, free)
```

## ğŸ¯ Success Criteria

âœ… All sources provide structured output  
âœ… No hallucinations in responses  
âœ… Graceful degradation  
âœ… User feedback collected  
âœ… Performance optimized  

